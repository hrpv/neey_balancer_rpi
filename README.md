# Neey Balancer Readout with Raspberry Pi

Read out your Neey (Jikong/Heltec) battery balancer directly from a Raspberry Pi via BLE‚Äîno ESP32 required

### This was my original readme, the other parts are generated by kimi after analyzing the repository:
> I was looking for a solution to use my existing raspberry pi to readout a neey balancer over ble without an additional esp32.
A perfect starting point was the code  of  esphome-jk-bms https://github.com/syssi/esphome-jk-bms 
With the help of 3 differerent AI Tools (Deepwiki, Kimi, Claude) i got a good working  solution with very low effort.
I asked deepwiki.com ‚ÄûCan you recode to Python‚Äú of the original code
https://github.com/syssi/esphome-jk-bms/blob/112f98f7/components/heltec_balancer_ble/heltec_balancer_ble.cpp 
https://deepwiki.com/search/can-you-recode-to-python_e17de732-e23e-45e7-a314-dcdbea442055?mode=deep 
which gave me a working python test solution of the original code. Now i put this python code in kimi.com 
prompt the ai tool add  MQTT Support, Install-tips as a service i put the kimi generated code parallel in https://claude.ai 
after some fine tuning both AI-tools delivered good working code I created not a single line of code by hand. 
I only prompted my requirements to the tools and the error messages of  the code which clearly doesnt work perfect at the first time, 
but after some iterations i had working code tailored to my needs.


## üéØ The AI-Assisted Development Journey

This project was built entirely through AI collaboration, demonstrating how modern tools can accelerate hardware interfacing development:

**Zero hand-written code**‚Äîjust requirements, error messages, and iteration!

## üöÄ Features

- ‚úÖ **Direct BLE Connection** - No ESP32 or additional hardware needed
- ‚úÖ **MQTT Integration** - Publish data to Home Assistant, Node-RED, or any MQTT broker
- ‚úÖ **Systemd Service** - Runs automatically on boot
- ‚úÖ **Low Resource** - Works on Pi Zero 2W, Pi 3, Pi 4
- ‚úÖ **Based on Proven Code** - Leverages [esphome-jk-bms](https://github.com/syssi/esphome-jk-bms) protocol knowledge

## üìÅ Repository Structure

| File | Description | Origin |
|------|-------------|--------|
| `neey_mqtt_kimi.py` | Initial MQTT implementation | Kimi AI |
| `neey_mqtt_claude.py` | Refined & optimized version | Claude AI |
| `blescan.py` | BLE device scanner | Utility |
| `neey-mqtt.service` | Systemd service configuration | Kimi AI |
| `README.md` | This file | Human + AI |

## üîß Requirements

- Raspberry Pi (3, 4, or Zero 2W) with Bluetooth
- Neey/Jikong/Heltec Balancer with BLE support
- Python 3.7+
- MQTT Broker (Mosquitto, Home Assistant, etc.)

## üì¶ Installation

### 1. Install Dependencies

```bash
sudo apt update
sudo apt install python3
pip bluetooth libbluetooth-dev
pip3 install bleak paho-mqtt
```
### 2. Find Your Balancer MAC Address
```bash

python3 blescan.py
```
Look for devices named "JK-BMS", "Neey", or "Heltec".

### 3. Configure
Edit the Python file (either version) and set:
```python

BALANCER_MAC = "XX:XX:XX:XX:XX:XX"  # Your balancer MAC
MQTT_BROKER = "192.168.1.100"        # Your MQTT broker IP
MQTT_PORT = 1883
MQTT_TOPIC = "neey/balancer"
```
### 4. Test Run
```bash
python3 neey_mqtt_kimi.py or neey_mqtt_claude.py
```

### 5. Install as Service
```bash
sudo cp neey-mqtt.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable neey-mqtt.service
sudo systemctl start neey-mqtt.service
```
Check status:
```bash
sudo systemctl status neey-mqtt.service
```
### üì° MQTT Topics
Data is published to subtopics under your configured base topic:
```table
Topic	Description	Unit
neey/balancer/cell_1_voltage	Cell 1 voltage	mV
neey/balancer/cell_2_voltage	Cell 2 voltage	mV
...	...	...
neey/balancer/total_voltage	Pack voltage	mV
neey/balancer/current	Current	mA
neey/balancer/soc	State of charge	%
neey/balancer/temperature_1	Temperature sensor 1	¬∞C
```
### üè† Home Assistant Integration
Add to configuration.yaml:
```yaml
mqtt:
  sensor:
    - name: "Battery Cell 1"
      state_topic: "neey/balancer/cell_1_voltage"
      unit_of_measurement: "mV"
      value_template: "{{ value | int / 1000 }}"
    
    - name: "Battery Total Voltage"
      state_topic: "neey/balancer/total_voltage"
      unit_of_measurement: "V"
      value_template: "{{ value | int / 1000 }}"
    
    - name: "Battery SOC"
      state_topic: "neey/balancer/soc"
      unit_of_measurement: "%"
```
### üõ†Ô∏è Troubleshooting
Permission Denied for BLE
```bash
# Option 1: Run as root (not recommended)
sudo python3 neey_mqtt_claude.py

# Option 2: Grant capabilities (recommended)
sudo setcap cap_net_raw,cap_net_admin+eip $(readlink -f $(which python3))
```

### Connection Drops
The code includes auto-reconnection logic. Check logs:
```bash
sudo journalctl -u neey-mqtt.service -f
```
No Data Received
- Ensure balancer is powered on and in range
- Verify MAC address is correct
- Check that balancer is not connected to another device (app)

### üß¨ Technical Background
This project translates the ESPHome C++ implementation from esphome-jk-bms to Python using:
1. DeepWiki - Automated C++ to Python transpilation of the protocol parser
2. Kimi - Added MQTT publishing, configuration structure, and systemd integration
3. Claude - Code review, error handling improvements, and optimization
The BLE protocol uses notification-based communication on service UUID 0000ff00-0000-1000-8000-00805f9b34fb.


### üìú License
MIT License - Feel free to use, modify, and distribute.
### üôè Acknowledgments
#### syssi/esphome-jk-bms - For the original protocol implementation
#### DeepWiki, Kimi, and Claude - For making this possible without writing a single line of code manually!

Made with ‚ù§Ô∏è and AI assistance
